<!DOCTYPE html>
<html>
<script src="https://ajax.googleapis.com/ajax/libs/angularjs/1.6.4/angular.min.js"></script>
<body>

<script>
var app = angular.module("payToPlay", []);
app.controller("myCtrl", function($scope, $http, $interpolate, $timeout) {
  // https://developers.google.com/apis-explorer/#p/civicinfo/v2/ API url formatter
  // key=AIzaSyB-zPHJ1O3BSWPVHMHI154vs9-Oye16tnA
  // $http.get("https://www.googleapis.com/civicinfo/v2/representatives/ocd-division%2Fcountry%3Aus%2Fstate%3Anc?key=AIzaSyB-zPHJ1O3BSWPVHMHI154vs9-Oye16tnA")

  $scope.repSearch = function() {
    let url = $interpolate('https://www.googleapis.com/civicinfo/v2/representatives?roles={{selectRole}}&address="{{selectedDivision}}"&key=AIzaSyB-zPHJ1O3BSWPVHMHI154vs9-Oye16tnA')({selectedDivision:$scope.selectedDivision.name, selectRole:$scope.selectRole});
    $http.get(url)
      .then(function(response) {
        $scope.representatives = response.data.officials;
      });
  };

  $scope.divisionsSearch = function() {
    let url = $interpolate('https://www.googleapis.com/civicinfo/v2/divisions?key=AIzaSyB-zPHJ1O3BSWPVHMHI154vs9-Oye16tnA&query="{{divisionsInput}}"')({divisionsInput:$scope.divisionsInput});

    $http.get(url)
    .then(function(response) {
      $scope.divisions = response.data.results;
      if ($scope.divisions) { $scope.selectedDivision = $scope.divisions[0]; }
    });
  };

  $scope.searchDivision = function() {
    console.log('hehe');
  }

  $scope.repRoles = ['headOfState', 'headOfGovernment', 'deputyHeadOfGovernment', 'governmentOfficer', 'executiveCouncil', 'legislatorUpperBody', 'legislatorLowerBody', 'highestCourtJudge', 'judge', 'schoolBoard', 'specialPropseOfficer']

});
</script>
<p>Pay To Play</p>

<div ng-app="payToPlay" ng-controller="myCtrl">
<!-- {{divisions}} -->
<input ng-model="divisionsInput" ng-change="divisionsSearch()" ng-model-options="{debounce: 1000}">
<select ng-model="selectedDivision" ng-options="x.name for x in divisions">
</select>

<select ng-model="selectRole" ng-options="x for x in repRoles">
</select>

<button ng-click="repSearch()">Search</button>

{{office}}

{{representatives}}
<ul>
  <li ng-repeat="x in representatives">
    <div ng-if="x.name">{{x.name}}</div>
    <div ng-if="x.party">{{x.party}}</div>
    <div ng-if="x.photoUrl">{{x.photoUrl}}</div>
    <img ng-src="{{x.photoUrl}}"/>
    <div ng-if="x.phones[0]">{{x.phones[0]}}</div>
    <div ng-if="x.address[0]">{{x.address[0].line1}}</div>
  </li>
</ul>

<!-- <input ng-model="repInput">
<select ng-model="selectedRep" ng-options="x.name for x in representatives">
</select> -->

</div>


</body>
</html>
